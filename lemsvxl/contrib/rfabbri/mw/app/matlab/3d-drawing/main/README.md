
# Algorithm 3D curve drawing system

**first of all go to lemsvpe/README.md, read it carefully and configure the programming environment**

## Input: sequence of images from the chosen dataset I<sub>j, (j=1,...,N).

## Output: 3D curve drawing of a scene or an object.

### Procedures:

#### 1. Turn the images into edgels, contours
 a. If in your dataset there are only png or jpg files, you will need to generate
    edg files, otherwise, move on to 1.b. For this, go to the terminal in the dataset and compile:
    parallel ::: edge ::: *.png (or *.jpg) 
    Then edg files will be generated by third order detection. To generate edg files one by one: 
    edge filename.png (or jpg)

 b. If in your dataset there aren't cemv files, you will need to generate them, otherwise, move on to 2.
    For this, got to the terminal in the dataset and compile:
    parallel ::: contours ::: --edgesuffix ::: .edg ::: *.png (or *.jpg)
    cemv files are generated. To generate cemv files one by one:
    contours --edgesuffix .edg filename.png (or jpg)

#### 2. Match the edge-curve
  a. Your dataset certainly does not contain edge-curve associations. These files are generated by edg_cemv_to_txt.m. Go to lemsvpe/lemsvxl/contrib/rfabbri/mw/app/matlab/3d-drawing/main and run it in MATLAB. Before that, create a folder called edge-curve inside the dataset. If the output contains a lot of zeros, your edg and cemv files are probably out of date. You may need to return to step 1.

#### 3. Enhanced reconstruction: generate attributes
 a. go lemsvpe/vxd/contrib/brld/bmvgd/bmcsd/cmd and make a copy of mcs_e for your dataset.
 TODO(Carlos): Where is mcs_e?

 b. go lemsvpe/lemsvxl/contrib/rfabbri/mw/scripts and make a copy of mcs_e_rec and mcs_e_rec_dataset. Replace the word dataset with some reference to the chosen dataset.

 c. make sure the lists and instances are ready

 d. the enhanced calls the compressed cemv and edg files in gz format and curve drawing calls them uncompressed.

 e. if in your dataset there aren't projmatrix files, you will need to generate them, otherwise, move on to 4. To do this, type the command

 TODO(Carlos): without extrinsics??
 
 -cam_type projcamera 
 
 in the mcs_e_rec_dataset options and run mcs_e_rec_dataset(the recorded parameters are the same as on paper): 

 ./mcs_e_rec_dataset 

 This will also generate the attributes needed for 3D curve drawing.

#### 4. go lemsvpe/lemsvxl/contrib/rfabbri/mw/app/matlab/3d-drawing/main 
  a. open matlab

  b. edit definitions_12 module: make changes to the variables numIM.

  c. edit load_pattern_12 function: put the path that accesses the .dat files below before mcs-rec folder. It is called in load_curve_sketch_without_associations.m module. 

  d. edit load_edge_and_curve_files module: there you will need to enter the paths where the cemv, edg, projmatrix, txt and png (or jpg) files are located.

  e. edit read_association_attributes_12 function: put the path where attributes from mcs_e are located.

  f. edit computing_associations module: put paths the projmatrix files are located.

#### 5. create two folders inside datset
  a. one named ply and put its path in write_curve_graph_to_vrml_12.m module. Replace the word dataset with some reference to the chosen dataset.

#### 6. add the path
  /home/biao/cprg/vxlprg/lemsvpe/lemsvxl/contrib/rfabbri/mw/app/matlab/3d-drawing/original

This will ensure that the distinguishable_colors, read_cons, read_cem_file, load_edg, get_length and find_closest_point_on_curve functions are accessed by the code.

#### 6. run curve_drawing_main.m

curve_drawing_main.m is average_curves_final_12 modularized or broken into different files. This code is written in matlab.

This text is being constantly updated and it will be
pasted into /home/biao/cprg/vxlprg/lemsvpe/doc/3d-curve-drawing.md
