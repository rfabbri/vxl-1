//: 
// \file     test_det_suppression_and_interpolation
// \brief    testing for suppression and interpolation
// \author   P. Klein 
// \date     2005-02-20
// 

#include <biob/biob_worldpt_field.h>
#include <testlib/testlib_test.h>
#include <biob/biob_worldpt_box.h>
#include <biob/biob_grid_worldpt_roster.h>
#include <vgl/vgl_vector_3d.h>
#include <det/det_suppression_and_interpolation.h>
#include <vcl_iostream.h>
//#include <vcl_fstream.h>
#include <vsl/vsl_binary_io.h>
#include <vsol/vsol_cylinder.h>
#include <vsol/vsol_cylinder_sptr.h>
#include <proc/io/proc_io_run_xml_parser.h>

static void test_det_suppression_and_interpolation_2(){

    vcl_FILE *xmlFile;
    xmlFile = vcl_fopen(fname.c_str(), "r");
    parser.parseFile(xmlFile);

  double r[] = {738275.288758, 767711.099434, 776028.708381, 762280.705338, 726309.258166, 668884.505408, 591912.938476, 498559.621718, 393141.616198, 280864.922805, 167281.583462, 
 817319.460486, 867896.123490, 894390.303650, 895006.750682, 868918.691565, 816428.298133, 739195.359171, 640414.736068, 524824.818454, 398405.870857, 267816.792198,
 869344.210658, 943168.871564, 990680.478718, 1009139.050428, 996938.128140, 953749.752773, 880805.777033, 781133.094204, 659612.229561, 522752.775271, 378152.420769,
 890617.003498, 988592.561576, 1058928.802251, 1097842.286592, 1102847.472843, 1072899.316677, 1008648.326494, 912727.537907, 789938.368956, 647052.701449, 492310.559982,
 879601.574740, 1001338.343863, 1095063.513234, 1155921.593681, 1180508.330084, 1166964.838455, 1115252.738520, 1027487.451389, 908128.558543, 763939.213233, 603553.457093,
 837134.984048, 980893.427469, 1097261.646322, 1180317.848183, 1225686.164306, 1230692.427849, 1194548.403799, 1118697.956995, 1007116.612374, 866317.897075, 704993.428576,
 766350.834136, 929164.927270, 1066147.005766, 1170330.552931, 1236441.864555, 1260953.713549, 1242302.301079, 1181232.889177, 1081084.887639, 947908.928864, 790241.030776,
 672446.015334, 850326.369522, 1004732.118810, 1127782.695523, 1213324.321929, 1257041.370831, 1256627.978184, 1212080.614035, 1126045.583021, 1003989.694170, 854021.169563,
 562091.644621, 750321.410874, 918073.542989, 1056663.424792, 1159193.114335, 1220625.700134, 1237953.091653, 1210479.420808, 1140125.720673, 1031662.092308, 892653.967415,
 442890.136153, 636415.564692, 812831.962022, 962868.689466, 1079003.968979, 1155601.700536, 1189046.901122, 1178003.962156, 1123693.154310, 1030185.071902, 904360.678153,
 322529.274915, 516347.906140, 696553.530171, 853488.814345, 979202.328907, 1067601.395321, 1114580.085400, 1118257.343228, 1079234.369304, 1000870.073733, 889351.589582, 

 695019.359343, 725816.827379, 735729.224099, 723653.943644, 689284.250100, 633272.926054, 557459.824687, 464993.168702, 360211.573385, 248360.668615, 135035.084214,
 774490.937569, 826480.554208, 854636.298244, 857004.252872, 832596.041327, 781580.708186, 705535.265194, 607625.929839, 492608.724188, 366508.116841, 236036.278817,
 826712.792302, 901958.708021, 951158.376221, 971414.465848, 960953.357701, 919302.822864, 847598.008600, 748825.987501, 627875.863729, 491301.233816, 346759.584168,
 848010.182342, 947368.299646, 1019367.015759, 1060075.647047, 1066844.311474, 1038477.995878, 975521.460632, 880556.386288, 758383.327680, 615815.021025, 461147.854977,
 836926.149559, 959961.471346, 1055269.107489, 1117863.997049, 1144187.429325, 1132233.653957, 1081854.305441, 995104.654024, 876434.893437, 732639.044243, 572406.706087,
 794374.244981, 939313.256758, 1057137.559555, 1141817.486329, 1188840.804774, 1195397.230772, 1160590.012665, 1085799.020897, 974982.074913, 834677.491756, 673621.050241,
 723544.766133, 887408.639050, 1025689.355124, 1131339.241030, 1198973.378047, 1224945.160810, 1207590.678286, 1147592.871220, 1048267.538474, 915681.101560, 758410.997676,
 629661.116648, 808467.022120, 964005.245838, 1088341.125809, 1175235.892460, 1220278.477196, 1221078.442875, 1177573.779666, 1092386.396033, 970994.626850, 821536.350436,
 519380.156123, 708441.913090, 877176.343517, 1016867.602212, 1120565.227047, 1183161.659080, 1201581.339283, 1175082.864815, 1105562.997389, 997798.517331, 859383.106115,
 400265.732727, 594570.830347, 771852.888440, 922832.532976, 1039957.399167, 1117548.330491, 1151947.298094, 1141781.287311, 1088253.296379, 995439.675109, 870243.474272,
 279942.631539, 474536.278721, 655540.731747, 813298.689942, 939853.930177, 1029093.498921, 1076886.162547, 1081330.854566, 1043015.597702, 965304.211715, 854404.098688, 

 665288.568398, 697553.406730, 709107.682286, 698683.188894, 665822.789073, 611068.448321, 536201.911181, 444359.944923, 339903.287494, 228112.453347, 114623.177105,
 744939.217577, 798416.549011, 828263.229132, 832356.708941, 809545.138850, 759869.257301, 684830.648296, 587572.920357, 472870.498208, 346790.075624, 216095.466599,
 797100.084056, 873799.907949, 924686.528796, 946699.095381, 937894.552654, 897660.229948, 827040.784734, 728987.989336, 608401.778976, 471878.382115, 327133.597264,
 818177.490876, 918903.528848, 992525.356666, 1034963.478581, 1043403.831225, 1016504.084221, 954707.989658, 860549.840078, 738830.395822, 596402.549883, 441618.722353,
 806804.388055, 931077.142275, 1027887.272493, 1092124.390551, 1120077.775447, 1109598.658035, 1060431.395475, 974573.216553, 856465.894664, 712933.693060, 552720.689012,
 763968.390172, 909987.988299, 1029151.337079, 1115331.514110, 1163886.857748, 1171874.338936, 1138291.204884, 1064454.052971, 954301.844724, 814396.638135, 653518.738657,
 692905.093954, 857691.046827, 997124.708894, 1104094.365571, 1173113.866324, 1200422.812954, 1184258.665819, 1125239.948145, 1026657.206400, 894591.015079, 737659.227356,
 598848.686092, 778437.471733, 934944.923140, 1060404.578459, 1148507.193992, 1194752.537287, 1196665.632671, 1154122.872058, 1069717.858036, 948937.162025, 799948.831503,
 488429.705590, 678175.662259, 847722.037794, 988348.742939, 1093069.202959, 1156712.230575, 1176134.702992, 1150542.950300, 1081803.979708, 974697.059371, 836843.199972,
 369168.700845, 564106.149284, 742083.950929, 893843.562431, 1011820.854458, 1090300.922020, 1125579.440336, 1116237.579821, 1063452.688441, 971300.273903, 846705.102903,
 248637.949459, 443857.759448, 625492.312344, 783917.001196, 911189.632429, 1001183.438868, 1049736.715923, 1054915.945442, 1017283.653680, 940200.636623, 829892.614484, 

 653766.234451, 687560.630752, 700775.640020, 691970.239644, 660530.476628, 606883.035676, 532746.214153, 441239.861332, 336744.368916, 224577.702860, 110431.335426,
 733197.509668, 788186.392689, 819719.343104, 825498.950229, 804203.840839, 755740.334821, 681528.313705, 584683.420588, 469994.473909, 343573.515935, 212248.925554,
 784923.284740, 863052.671090, 915586.366887, 939297.769524, 932068.358760, 893138.694912, 823455.376173, 725927.189161, 605461.156541, 468697.668144, 323421.042934,
 805449.812098, 907467.546886, 982631.005870, 1026714.235291, 1036735.956391, 1011199.126509, 950437.687566, 856929.910922, 735470.257949, 592951.432061, 437791.230512,
 793505.454721, 918889.277867, 1017077.816653, 1082843.016290, 1112321.446143, 1103215.592284, 1055152.094011, 970058.854516, 852361.603175, 708912.598068, 548515.426052,
 750146.205810, 897077.578284, 1017417.001150, 1104953.945288, 1154921.089357, 1164236.717338, 1131781.416487, 1058796.129143, 949189.856153, 809543.428187, 648686.116099,
 678641.431018, 844147.440178, 984539.500780, 1092661.416210, 1162931.930649, 1191473.360176, 1176413.516248, 1118290.815782, 1020358.563815, 888704.386571, 731986.053292,
 584223.535568, 764369.606805, 921628.721584, 1048026.191329, 1137193.051119, 1184536.897018, 1187485.742763, 1145838.571119, 1062145.727605, 941891.563473, 793273.851961,
 473491.009368, 663677.450323, 833801.354793, 975166.418180, 1080761.311801, 1145349.191658, 1165707.620645, 1140971.051943, 1072960.517233, 966446.047505, 829071.244214,
 353922.851813, 549232.295489, 727657.934344, 879991.620215, 998671.473490, 1077944.950640, 1114046.459077, 1105491.557440, 1053413.093189, 961870.910126, 837806.618864,
 233054.741485, 428618.707553, 610618.523519, 769495.158013, 897333.731831, 987991.028189, 1037259.193806, 1043148.824839, 1006175.323848, 929681.007925, 819902.283594, 

 661414.362543, 696773.119552, 711657.731786, 704444.233596, 674346.914173, 621661.129931, 548026.290346, 456535.951474, 351592.535319, 238568.369116, 123244.864613,
 740111.309162, 796602.764705, 829803.299559, 837232.194473, 817384.515080, 770014.860743, 696444.311402, 599749.961426, 484733.706860, 357567.072913, 225173.188971,
 790945.809819, 870443.479622, 924567.512374, 949921.181529, 944197.484544, 906472.874851, 837577.367321, 740362.407354, 619738.582828, 482400.005342, 336224.213857,
 810538.545054, 913731.573209, 990336.309599, 1035980.947272, 1047506.914653, 1023244.887374, 963399.053887, 870375.225460, 748953.172663, 606069.974553, 450229.369065,
 797715.230430, 924040.378598, 1023462.858575, 1090642.392545, 1121555.622799, 1113740.577787, 1066685.005554, 982227.680183, 864766.611001, 721181.907429, 560349.663158,
 753593.444738, 901219.907683, 1022549.563673, 1111299.337973, 1162573.403945, 1173135.996016, 1141729.825651, 1069498.967999, 960306.021763, 820745.025993, 659703.169383,
 681466.648799, 847435.431576, 988563.872294, 1097667.262600, 1169068.624468, 1198760.376498, 1184739.676214, 1127440.377801, 1030060.281393, 898684.300696, 742010.934710,
 586556.735528, 766968.425141, 924726.228919, 1051866.359864, 1141963.721120, 1190321.852789, 1194250.171328, 1153446.072213, 1070395.055479, 950564.754566, 802180.869139,
 475429.188030, 665732.027593, 836151.885941, 978039.161350, 1084361.481272, 1149805.818592, 1171050.216493, 1147130.363706, 1079798.755111, 973799.517587, 836790.860152,
 355526.192690, 550850.332069, 729413.991078, 882083.084218, 1001304.197550, 1081277.017554, 1118152.367946, 1110354.300042, 1058946.891576, 967954.815947, 844327.029459,
 234361.474958, 429874.167374, 611896.350563, 770961.313624, 899186.455816, 990401.840295, 1040331.654326, 1046902.657812, 1010557.813337, 934601.485848, 825268.475918, 

 685274.353784, 722218.310667, 738779.920589, 733136.191914, 704306.943736, 652433.305072, 579057.390611, 487240.990253, 381421.619659, 267059.108939, 150075.270935,
 762665.049927, 820634.723866, 855482.034806, 864529.364330, 846066.929789, 799673.272228, 726550.055537, 629726.913220, 514025.510964, 385703.851521, 251824.116907,
 812126.514336, 892915.802457, 948572.354776, 975519.617317, 971242.532207, 934629.512481, 866370.957340, 769246.926303, 648173.200411, 509916.718159, 362484.276009,
 830403.986522, 934641.133131, 1012587.398712, 1059720.441206, 1072687.849338, 1049624.155055, 990579.252118, 897868.828350, 776252.392896, 632722.362299, 475897.232944,
 816419.852845, 943501.701791, 1044015.925040, 1112509.275584, 1144785.057581, 1138195.038475, 1092062.419706, 1008114.898792, 890711.960351, 746764.877338, 585240.466457,
 771346.360859, 919434.369197, 1041570.663040, 1131403.863483, 1183900.141318, 1195648.749581, 1165228.973541, 1093664.263785, 984753.973989, 845100.678812, 683660.806540,
 698493.521188, 864645.860366, 1006288.323894, 1116215.589430, 1188647.436043, 1219428.280390, 1206399.878582, 1149864.840050, 1052945.710273, 921714.229217, 764910.033701,
 603066.783827, 783422.437541, 941419.768472, 1069115.930648, 1160025.864291, 1209331.870055, 1214200.221976, 1174200.863925, 1091731.389663, 972226.338324, 823935.265694,
 491599.528990, 681654.303703, 852073.680750, 994267.569857, 1101178.153335, 1167400.822083, 1189491.719253, 1166360.382176, 1099667.379783, 994112.207649, 857355.919381,
 371499.884369, 566430.580136, 744797.656915, 897553.626581, 1017151.337525, 1097727.801380, 1135327.101057, 1128256.949161, 1077488.809632, 986991.143732, 863706.533896,
 250267.193833, 445274.560517, 626942.671262, 785911.910160, 914327.944129, 1005979.528083, 1056501.526746, 1063711.840455, 1027958.405870, 952487.913378, 843517.286118, 

 719214.267221, 757757.817686, 776000.362001, 771898.889608, 744253.644139, 693029.529519, 619658.337852, 527174.451568, 420075.817946, 303955.162550, 184932.494867,
 794749.976141, 854171.171134, 890644.892184, 901278.704296, 884134.476527, 838591.038377, 765714.525607, 668485.820866, 551762.970355, 421926.573827, 286228.016934,
 842405.132037, 924412.870653, 981550.683853, 1010047.570544, 1007159.054646, 971562.299073, 903788.651945, 806539.002594, 684743.142788, 545266.630894, 396285.442790,
 859054.400757, 964214.433176, 1043416.057480, 1091976.197560, 1106329.828582, 1084392.375367, 1026038.209951, 933480.125246, 811457.288615, 667032.597152, 508969.740419,
 843713.451638, 971383.059284, 1072867.144744, 1142592.136533, 1176171.997884, 1170751.159526, 1125466.046765, 1041915.594085, 924413.783358, 779908.597301, 617475.732845,
 797601.752195, 945937.071569, 1068721.869835, 1159532.659167, 1213184.768696, 1226072.421685, 1196589.239644, 1125618.370580, 1016882.282743, 876988.174978, 714970.985368,
 724039.223401, 890116.176221, 1032078.429840, 1142698.310014, 1216080.691531, 1247904.510654, 1235835.056931, 1180021.601930, 1083494.453781, 952301.588313, 795221.282043,
 628209.238872, 808206.176770, 966212.259953, 1094304.263649, 1185928.155958, 1236128.379542, 1241907.902260, 1202688.544438, 1120760.187204, 1001507.714163, 853196.344881,
 516611.878176, 706071.327135, 876220.798734, 1018529.925078, 1125904.948413, 1192834.891714, 1215736.516574, 1193372.487407, 1127292.162101, 1022131.964507, 885539.913296,
 396618.195618, 590764.099175, 768626.124542, 921241.837692, 1041061.220839, 1122144.215206, 1160411.154313, 1154036.672258, 1103881.515197, 1013838.410958, 890825.896046,
 275709.149943, 469777.930213, 650743.870053, 809353.646446, 937769.442752, 1029724.672529, 1080750.893614, 1088542.015043, 1053336.534819, 978306.754805, 869632.639733, 

 755431.691554, 795582.857461, 815496.543747, 812888.913699, 786321.046223, 735568.809416, 661952.573240, 568495.740267, 459790.793093, 341612.435474, 220332.009279,
 828677.907315, 889527.242753, 927601.609198, 939775.812807, 923865.103537, 879034.249497, 806208.853618, 708329.800725, 590315.753840, 458707.790123, 320991.216991,
 874223.371797, 957391.924795, 1015965.410066, 1045962.672234, 1044393.812564, 1009710.305595, 942275.461936, 844713.004538, 721981.056463, 581070.206259, 430359.925414,
 889070.643188, 995060.928996, 1075449.860681, 1125381.075562, 1141062.226237, 1120175.844650, 1062409.729091, 969869.677786, 847279.744336, 701788.137007, 542327.560419,
 872321.089673, 1000450.909655, 1102813.564415, 1173703.671149, 1208533.451364, 1204227.070658, 1159722.205193, 1076480.493012, 958767.842505, 813573.656460, 650094.739261,
 825231.949571, 973652.775826, 1096969.946267, 1188677.982588, 1243430.196416, 1257414.110842, 1228825.751536, 1158397.095916, 1049765.407079, 909537.858877, 746830.502500,
 751124.689309, 916929.209562, 1059068.892276, 1170283.416597, 1244552.136152, 1277378.231701, 1266239.855376, 1211121.252661, 1114948.610600, 983735.256067, 826290.396652,
 655152.760628, 834558.452073, 992402.696991, 1120770.423274, 1213028.376203, 1264073.639967, 1270736.945822, 1232281.736550, 1150877.024851, 1031842.548602, 883445.552193,
 543776.338219, 732372.243356, 902050.993796, 1044329.576157, 1152066.014750, 1219634.590147, 1243306.326337, 1221688.807757, 1156208.658054, 1051422.722723, 914946.591393,
 424318.164492, 617378.264457, 794505.205323, 946806.111270, 1066715.310830, 1148207.294697, 1187074.290369, 1181354.199481, 1131788.569303, 1042178.961085, 919399.224070,
 304224.317608, 497027.503092, 677035.562940, 835084.330390, 963336.355090, 1055461.460557, 1106886.667001, 1115182.068160, 1080474.036099, 1005849.090405, 897430.334439, 

 786307.784080, 828060.713876, 849607.770378, 848410.542588, 822784.539080, 772319.352681, 698237.206879, 603576.616098, 493060.507974, 372687.432300, 249116.935919,
 857031.761971, 919286.345767, 958918.460480, 972558.871226, 957770.809359, 913505.822646, 840558.566030, 741847.477497, 622377.678449, 488881.460160, 349107.303620,
 900369.234520, 984658.604345, 1044619.372219, 1076049.454112, 1075709.683248, 1041826.772733, 974601.181513, 876590.729955, 752797.862875, 610357.931837, 457873.944307,
 913440.257126, 1020204.754680, 1101726.502782, 1152966.231832, 1169900.633578, 1149980.554077, 1092710.714145, 1000095.422384, 876851.371791, 730221.375407, 569317.714812,
 895418.626273, 1023936.933606, 1127117.500049, 1199112.405124, 1235129.245522, 1231873.394751, 1188086.731108, 1105095.585376, 987118.840250, 841187.790294, 676621.422989,
 847585.438206, 996004.351623, 1119785.532231, 1212329.551745, 1268124.391908, 1283153.169293, 1255417.366576, 1185498.388094, 1076945.231276, 936357.961923, 772926.963691,
 773251.551753, 938679.034523, 1080918.136106, 1192661.124581, 1267757.276276, 1301536.765499, 1291295.220339, 1236852.974084, 1141026.841596, 1009784.124082, 851950.590982,
 677527.891103, 856220.211527, 1013813.056322, 1142381.047407, 1235205.597374, 1287039.331858, 1294547.327489, 1256838.214941, 1175955.433826, 1057139.734510, 908641.824138,
 566821.487482, 754415.513180, 923521.376036, 1065681.956949, 1173697.360190, 1241830.503189, 1266215.851831, 1245312.897464, 1180423.959491, 1076013.495273, 939642.702562,
 448387.670155, 640212.498614, 816492.824726, 968378.565508, 1088276.693366, 1170078.782166, 1209460.665894, 1204336.057120, 1155330.470011, 1066144.380051, 943585.491593,
 329611.449943, 520998.655295, 699934.869030, 857314.473813, 985283.978281, 1077451.562455, 1129154.979690, 1137857.832378, 1103585.048869, 1029333.064448, 921148.958316, 

 806123.033155, 849445.414808, 872546.430339, 872633.160739, 847787.559387, 797432.861835, 722719.089756, 626729.665938, 514346.861296, 391818.354111, 266104.844999,
 874362.281269, 937988.802993, 979104.985648, 994098.840482, 980293.803046, 936447.269869, 863245.479715, 763606.340265, 642642.263290, 507292.400225, 365575.426041,
 915651.545378, 1001031.340339, 1062314.733912, 1095078.937915, 1095848.897680, 1062645.217889, 995524.712292, 896997.005995, 772120.977687, 628184.057154, 474013.603487,
 927208.045473, 1034722.396999, 1117323.694581, 1169788.560214, 1187874.739748, 1168820.939703, 1111967.012759, 1019228.954268, 895323.171805, 747586.707736, 585305.088405,
 908256.688021, 1037147.301998, 1141105.338143, 1214136.010876, 1251253.852000, 1248964.222045, 1205831.782815, 1123059.762437, 1004822.269619, 858186.421423, 692582.006610,
 860082.875835, 1008491.989878, 1132709.527826, 1226033.630339, 1282795.768635, 1298794.385246, 1271855.710208, 1202422.376269, 1093956.700685, 953041.445073, 788924.487929,
 785969.065650, 951019.359983, 1093342.031489, 1205567.842418, 1281422.576350, 1316082.057251, 1306680.513226, 1252889.255220, 1157416.784540, 1026172.646045, 867979.640251,
 690966.293282, 868953.019789, 1026289.586629, 1155020.546624, 1248344.116928, 1300887.130292, 1309172.756428, 1272172.429095, 1191808.276091, 1073231.203939, 924653.415356,
 581409.247064, 768019.953383, 936559.962369, 1078572.349826, 1186797.407694, 1255404.445830, 1280417.273957, 1260170.331028, 1195850.219507, 1091820.828515, 955567.566487,
 464462.442698, 655087.577447, 830544.912857, 981994.885111, 1101810.737089, 1183817.472789, 1223603.729580, 1218987.284709, 1170492.427764, 1081715.609092, 959378.420538,
 347419.701169, 537454.731475, 715368.467940, 872075.026859, 999693.309406, 1091784.800275, 1143629.816895, 1152619.779288, 1118701.203829, 1044783.320486, 936821.687761, 

 812204.636643, 857023.482938, 881548.406634, 882749.932412, 858507.375864, 808112.455203, 732675.685865, 635351.446949, 521196.211084, 396709.710405, 269140.816848,
 878300.927226, 943240.473993, 985723.972778, 1001914.752300, 988927.666364, 945360.647488, 871822.801395, 771252.013278, 648877.541178, 511842.354922, 368419.048854,
 917977.670140, 1004410.908433, 1066920.817127, 1100879.352502, 1102607.110406, 1069953.756972, 1002862.282306, 903813.162650, 777926.279451, 632633.313632, 476967.144356,
 928517.661573, 1036773.294079, 1120384.686152, 1173956.041022, 1193055.711578, 1174746.746675, 1118234.585665, 1025364.465379, 900855.714893, 752128.450148, 588619.357201,
 909167.612594, 1038454.765373, 1143151.559615, 1217122.894976, 1255217.945291, 1253777.852942, 1211222.299652, 1128650.874767, 1010195.075640, 862945.159964, 696418.972748,
 861191.315067, 1009649.412825, 1134298.039220, 1228332.555776, 1285951.580933, 1302805.520611, 1276579.374883, 1207598.264685, 1099242.856689, 958065.963946, 793348.825915,
 787820.167779, 952587.770746, 1095023.296936, 1207688.102958, 1284204.317814, 1319628.472395, 1310969.935756, 1257777.289089, 1162657.947770, 1031453.058443, 872960.083457,
 694024.610961, 871437.080284, 1028582.490842, 1157459.741037, 1251197.715527, 1304332.061233, 1313283.305820, 1276915.912577, 1197043.342176, 1078719.831432, 930097.349327,
 586045.785101, 771844.871831, 939922.706420, 1081799.044703, 1190163.125513, 1259123.663090, 1284635.029125, 1264942.964063, 1201136.569017, 1097476.950517, 961355.380733,
 470934.847634, 660578.004269, 835359.939131, 986420.062653, 1106101.002725, 1188191.968552, 1228238.687704, 1224004.600048, 1175937.636771, 1087534.279776, 965414.629105,
 355868.567913, 544824.374109, 721915.737919, 878037.014855, 1005276.821311, 1097178.456503, 1149011.240586, 1158141.619004, 1124470.503131, 1050829.887705, 943073.305070};


  const unsigned dim = 11;
  biob_worldpt_box box(0, 0, 0, dim-1, dim-1, dim-1);
  biob_grid_worldpt_roster * grid = new biob_grid_worldpt_roster(box, 1.);
  biob_worldpt_field<vgl_vector_3d<double> >  field(grid);
  vgl_vector_3d<double> vertical(0,0,1);
  int counter = 0;
  for(int i=0; i<dim; i++) {
    for(int j=0; j<dim; j++) {
      for(int k=0; k<dim; k++) {
        double strength = r[counter++];
        vcl_cout << "(" << i << ", " << j << ", " << k << "): " << strength << "\n";
        field.values()[(grid->index_3d_2_1d(i,j,k)).index()] = strength * vertical;
      }
    }
  }
  det_suppression_and_interpolation sup;
  biob_worldpt_field<vgl_vector_3d<double> >  new_field = sup.apply(field, 1.5, 1.5, 2.*3.14*40./360, .4);
  
  // create cylinder and write to binary stream
  vcl_vector<vsol_cylinder_sptr> cylinders;
  vcl_vector<double> strengths;
  vsl_b_ofstream stream("cylinders_after_suppression");
  
  const double CYL_RADIUS = 0.5;
  const double CYL_LENGTH = 1.0;
  for (int i = 0; i < new_field.roster()->num_points(); ++i){
    vsol_cylinder_sptr cyl = new vsol_cylinder(new_field.roster()->point(biob_worldpt_index(i)), CYL_RADIUS, CYL_LENGTH);
    cyl->set_orientation(normalize(field.values()[i]));
    cylinders.push_back(cyl);
    strengths.push_back(field.values()[i].length());
  }
  // write the version number
  vsl_b_write(stream, (int) 1);

  // write the number of cylinders
  vsl_b_write(stream, (int) cylinders.size());

  for (unsigned int i=0; i<cylinders.size(); i++){
    vsol_cylinder_sptr cyl = cylinders[i];
    // first write the strength
    vsl_b_write(stream, (double) strengths[i]);
    cyl->b_write(stream);
  }
  stream.close();
}

TESTMAIN(test_det_suppression_and_interpolation_2);
